# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Описание

В проекте применен принцип MVP (Model-View-Presenter), который обеспечивает четкое разделение ответственностей между классами Model и View каждый класс выполняет свою определенную роль:

- **Model (Модель)**: работает с данными, выполняет бизнес-логику и управляет состоянием приложения.
- **View (Представление)**: отвечает за отображение данных пользователю и обработку взаимодействий.
- **Presenter (Представитель)**: связывает Model и View, обрабатывает события и координирует взаимодействие между слоями.

## Функции основных частей

- **Model**: хранит и обрабатывает данные приложения, взаимодействует с сервером.
- **View**: отображает данные, предоставляет интерфейс для взаимодействия с пользователем.
- **Presenter**: реагирует на действия пользователя, обновляет модель и инициирует обновление представления.

## Взаимодействие частей

1. Пользователь взаимодействует с **View** (например, кликает на элемент).
2. **View** генерирует событие и передаёт его **Presenter** через `EventEmitter`.
3. **Presenter** вызывает методы **Model** для изменения данных.
4. **Model** обновляет данные и генерирует событие через `EventEmitter`.
5. **Presenter** обрабатывает событие, запрашивает обновлённые данные из **Model** и вызывает методы **View** для обновления интерфейса.

---

## Компоненты приложения

### Базовые классы

#### Класс `Api`
**Назначение**: базовый класс для управления HTTP-запросами к серверу. Предоставляет общие методы для работы с API, включая обработку ответов и управление опциями запросов.

**Поля**:
- `baseUrl: string` - базовый URL для API-запросов.
- `options: RequestInit` - настройки запросов, включая заголовки и другие параметры.

**Методы**:
- `handleResponse(response: Response): Promise<object>` -  обработчик ответа сервера.
- `get(uri: string)` - принимает изменяющеюся часть url-адреса, возвращает ответ от сервера.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')`- выполняет POST, PUT или DELETE-запрос на указанный URI с указанными данными.
---

#### Класс `EventEmitter`
**Назначение**: брокер событий, реализующий паттерн **Observer**.

**Поля**:
- `_events: Map<EventName, Set<Subscriber>>`- хранилище событий и связанных с ними подписчиков.

**Методы**:
- `on` - подписка на событие.
- `off`- отписка от события.
- `emit`- инициирует событие с данными.
- `onAll`- подписка на все события.
- `offAll`- сброс всех подписчиков.
- `trigger`- генерирует событие при вызове.
---

### Слой Model

### Класс `ApiClient`
**Назначение**: управление запросами к серверу.

**Поля**
- `serverUrl: string` - базовый URL сервера для API.

**Методы**
- `fetchProducts`: загружает список товаров.
- `postOrderLot`: получает ответ от сервера.
---

#### Класс `AppData`
**Назначение**: работа с данными, полученными с сервера.

**Поля**
- `productsCards: Product[]` - хранит внутренний список карточек продуктов.
- `selectedCard: Product` - выбранная карточка продукта.

**Методы**
- `productCards(data: Product[])`- обновляет внутренний список карточек продуктов.
- `setPreview(item: Product)`- устанавливает переданную карточку как текущую выбранную.
---

#### Класс `BasketManager`
**Назначение**: хранит и работает с данными, полученными от пользователя

**Поля**
- `basket: Product[]` - хранит список текущих товаров в корзине.

**Методы**
- `getCounter(): number`: возвращает общее количество товаров в корзине.
- `getSumAllProducts(): number`: рассчитывает и возвращает общую стоимость всех товаров в корзине
- `addToBasket(data: Product)`: добавляет товар в корзину.
- `removeFromBasket(item: Product): void`: удаляет товар из корзины.
- `clearBasket()`: очищает корзину, удаляя все товары.
---

#### Класс `OrderFormManager`
**Назначение**: хранит и работает с данными, полученными от пользователя

**Поля**
- `payment: string`- хранит выбранный способ оплаты.
- `email: string` - хранит адрес электронной почты пользователя.
- `phone: string` - хранит номер телефона пользователя.
- `address: string` - хранит адрес доставки заказа.
- `total: number` - общая сумма заказа.
- `items: string[]` список идентификаторов товаров в заказе.
- `formErrors: FormErrors` - хранит ошибки валидации формы, сгруппированные по полям.
- `events: IEvents` - экземпляр системы событий для взаимодействия с другими частями приложения.

**Методы**
- `setOrderAddress(field: string, value: string): void` - устанавливает адрес доставки и запускает валидацию.
- `validateOrder(): boolean` - проверяет корректность указанных данных адреса и способа оплаты.
- `setOrderData(field: string, value: string): void` - устанавливает значение для email или телефона и запускает валидацию.
- `validateContacts(): boolean` - проверяет корректность указанных данных email и телефона.
- `returnOrderLot(): object` - возвращает объект с данными заказа.
---

### Слой View

#### **Класс `Modal`**  
**Назначение**: управление отображением модальных окон.  

**Поля**:  
- `modalElement: HTMLElement` - элемент модального окна.  
- `contentElement: HTMLElement` - контейнер для контента модального окна.
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна.
- `pageWrapper: HTMLElement`- элемент, оборачивающий страницу, используется для блокировки прокрутки.
- `events: IEvents` - экземпляр событийного брокера для обработки и генерации событий (modal:open, modal:close).

**Методы**:  
- `open(): void` - открывает модальное окно.  
- `close(): void` - закрывает модальное окно.  
- `setContent(value: HTMLElement): void` - устанавливает содержимое модального окна.  
- `setLocked(value: boolean): void` - блокирует или разблокирует прокрутку страницы.
- `render(): HTMLElement` - отображает модальное окно, вызывая метод open.
--- 

#### **Класс `Basket`**  
**Назначение**: отображение корзины товаров.

**Поля**:  
- `basketElement: HTMLElement` - элемент корзины.  
- `title: HTMLElement` - заголовок корзины.
- `basketList: HTMLElement` - список товаров в корзине.
- `button: HTMLButtonElement` -  кнопка, которая активирует корзину.
- `basketPrice: HTMLElement` - отображение общей стоимости товаров в корзине.
- `headerBasketButton: HTMLButtonElement` - кнопка в шапке сайта, которая открывает корзину.
- `headerBasketCounter: HTMLElement` -  элемент в шапке сайта для отображения количества товаров в корзине.

**Методы**:  
- `renderHeaderBasketCounter(value: number): void` - обновляет отображение количества товаров в корзине в шапке сайта.  
- `renderSumAllProducts(sumAll: number): void` - обновляет общую стоимость товаров.  
- `render(): HTMLElement` - генерирует и возвращает элемент DOM, который представляет корзину покупок.   
---

#### **Класс `BasketItem`**  
**Назначение**: класс управляет отображением элемента в корзине покупок, включая информацию о товаре, цене и кнопку для его удаления из корзины.

**Поля**:  
- `basketItem: HTMLElement` - элемент для отображения товара в корзине.
- `index: HTMLElement` - элемент для отображения индекса (порядкового номера) товара в корзине.
- `title: HTMLElement` -  элемент для отображения названия товара.
- `price: HTMLElement` - элемент для отображения цены товара.
- `buttonDelete: HTMLButtonElement` - кнопка для удаления товара из корзины.

**Методы**: 
- `setPrice(value: number | null): string` - метод для форматирования цены товара.
- `render(data: Product, item: number): HTMLElement` - метод для рендеринга элемента товара в корзине.
---

#### **Класс `Card`**  
**Назначение**: отображение карточки товара.  

**Поля**:  
- `cardElement: HTMLElement` - элемент карточки товара.  
- `cardCategory: HTMLElement` - элемент, отображающий категорию продукта.
- `cardTitle: HTMLElement` - элемент, отвечающий за отображение названия продукта.
- `cardImage: HTMLImageElement` - элемент для отображения изображения продукта.
- `cardPrice: HTMLElement` - элемент, отображающий стоимость продукта.
- `colors: Record<string, string>` - объект для преобразования категорий продуктов в соответствующие классы для изменения их оформления.
- `events: IEvents` - экземпляр событийного брокера для обработки взаимодействий.
- `actions (опционально): IActions` - объект с обработчиками событий, таких как нажатие на карточку.

**Методы**:  
- `setText(element: HTMLElement, value: unknown): string` - задаёт данные товара для отображения.  
- `setCategory(value: string)` - устанавливает категорию продукта.
- `setPrice(value: number | null): string` - устанавливает цену.
- `render(data: Product): HTMLElement` - отрисовывает карточку товара.  
---

#### **Класс `ProductCardPreview`**  
**Назначение**: управляет отображением карточки товара в превью (с информацией о товаре) и возможностью добавить товар в корзину. Наследуется от Card.  

**Поля**: 
Наследуются от класса Card.

**Методы**:
- `notSale(data: Product): string` - проверяет наличие цены у товара.
- `render(data: Product): HTMLElement` - заполняет все поля карточки — категорию, название, изображение, цену, описание и текст на кнопке. Затем возвращает готовый элемент карточки с заполняемыми данными.
---

#### **Класс `Order`** 
**Назначение**: управление отображением и взаимодействием с формой оформления заказа, включая выбор метода оплаты, обработку ввода данных и отправку формы.

**Поля**:
- `formOrder: HTMLFormElement` - Элемент формы заказа.
- `buttonAll: HTMLButtonElement[]` - Массив кнопок, которые служат для выбора метода оплаты.
- `buttonSubmit: HTMLButtonElement` - Кнопка отправки формы.
- `formErrors: HTMLElement` - Элемент, отображающий ошибки валидации формы.
- `paymentSelection: string` - Метод оплаты, выбранный пользователем.

**Методы**: 
- `paymentSelection(paymentMethod: string)`- устанавливает выбранный метод оплаты и обновляет внешний вид кнопок.
- `valid(value: boolean)` - управляет состоянием кнопки отправки формы.
- `render(): HTMLElement` - возвращает форму для отображения на странице.
---

#### **Класс `Contacts`**  
**Назначение**: управление отображением и валидацией контактных данных пользователя.

**Поля**:  
- `contactElement: HTMLElement` - элемент формы контактов.  
- `inputAll: HTMLInputElement[]` - массив всех полей ввода, которые находятся внутри формы.
- `buttonSubmit: HTMLButtonElement` - кнопка отправки формы.
- `formErrors: HTMLElement` - ошибки формы.

**Методы**:  
- `validateContacts(value: boolean)` - управляет состоянием кнопки отправки формы.  
- `render(): HTMLElement` - возвращает саму форму, готовую для отображения.  
---

#### **Класс `Success`**  
**Назначение**: отображение сообщения об успешном завершении заказа.

**Поля**:  
- `successElement: HTMLElement` - элемент для отображения сообщения.  
- `messageElement: HTMLElement` - элемент для текста сообщения.  
- `button: HTMLButtonElement` - кнопка для закрытия сообщения об успешной операции.
- `events: IEvents` - Экземпляр событийного брокера для обработки событий, таких как закрытие сообщения.

**Методы**:  
- `constructor(template: HTMLTemplateElement, events: IEvents)` - инициализирует экземпляр класса, клонируя шаблон успешного сообщения и настраивая элементы.  
- `render(total: number): HTMLElement` - возвращает корневой элемент success.  
---

### **Слой Presenter**
Код, относящийся к слою **Presenter**, реализован в основном скрипте приложения (`index.ts`).

---

## Пример взаимодействия компонентов

**Сценарий: добавление товара в корзину**

1. Пользователь нажимает кнопку "Добавить в корзину" на карточке товара в View (например, в **ProductCardPreview**).
2. В View компонента **ProductCardPreview** генерируется событие `addToBasket`, которое передается через EventEmitter в Presenter.
3. **Presenter** подписан на событие `addToBasket`.
4. В **BasketManager** вызывается метод `addToBasket`, который добавляет товар в корзину.
5. **BasketManager** генерирует событие `updateBasket`, которое передает обновленную корзину.
6. **Presenter** подписывается на событие `updateBasket`.
7. **View** обновляет интерфейс, отображая количество товаров в корзине и их общую стоимость.
---

## Данные и типы

Данные и типы:

1. **Product** - объект товара с полями:

- `id: string` — уникальный идентификатор товара.
- `title: string` — название товара.
- `price: number` — цена товара.
- `imageUrl: string` — URL изображения товара.

2. **BasketManager**:

- `basket: Product[]` — массив товаров в корзине.

3. **EventEmitter**:

- События: `addToBasket`, `updateBasket`.

4. Типы событий:

- `addToBasket`: Событие, вызываемое при добавлении товара в корзину.
- `updateBasket`: Событие, вызываемое для обновления корзины (например, для отображения изменений в интерфейсе).

---

## Реализация процессов через события

1. Добавление товара в корзину:

- **View** генерирует событие `addToBasket`.
- **Presenter** обрабатывает это событие, передает данные в **BasketManager**.
- **BasketManager** добавляет товар в корзину и генерирует событие `updateBasket`.
- **Presenter** снова обрабатывает событие, обновляя представление корзины.

2. Обновление интерфейса корзины:

- При добавлении товара в корзину или других изменениях (удаление товара, изменение количества), **BasketManager** генерирует событие `updateBasket`.
- **Presenter** и **View** обрабатывают это событие, чтобы обновить UI (например, обновление счетчика товаров и суммы в корзине).

